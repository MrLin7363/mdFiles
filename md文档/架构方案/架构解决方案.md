架构解决方案

视频：https://www.bilibili.com/video/BV1LB4y1Q7Zo?p=38&vd_source=0ee4a5fcc4ed2246ba902aa714c4428b

## 一、分库分表

### 1. 如何支持多个分片键查询





## 二、高可用

### 2.1 依赖放通降级

### 2.2 过载控制

### 2.3 弹性

#### 2.3.1 容器弹性伸缩

根据业务需求和策略，经济地自动调整计算资源的管理服务（如实例个数）

高可用&节省资源（业务量低时，使用较少实例）

触发条件：CPU使用率、内存使用率、每秒http请求量、每分钟所有请求平均响应时长、JVM Heap使用率、线程池使用率、老年代GC耗时占比等

推荐使用 CPU使用率 & 每秒HTTP请求数

阈值配置推荐： 

CPU使用率配置：大于等于峰值CPU使用率 且<90% 

每秒HTTP请求数：稍大于峰值QPS       

峰值QPS计算:( 总PV数 * 80% ) / ( 每天秒数 * 20% ) = 峰值时间每秒请求数(QPS)

### 2.4 爆炸半径控制

#### 2.4.1 桶双region 

上传任务实现双region，  双写到双region，读取优先主region

单边上传故障，上传到另一边，同事task定时任务记录失败，定时同步失败的到另一边

### 2.5 容灾多活

#### 2.5.1  网关双通道 

xx1.com 故障由业务代码自动切换 xx2.com 副集群

#### 2.5.2 redis集群双活同步

情况：redis有两个region的集群，之间数据是不同步的，只有初始化时一样

解决方案：通过aop拦截当前region的redis操作，然后异步消息队列 kafka/rocketMq 发送到另一个region的redis集群进行数据还原操作，实现增量数据更新

优势： 对代码侵入性小：引入组件后，只需增加配置信息，无需开发额外代码

### 2.6 数据可靠性

### 2.7 极限生存

### 2.8 变更管理

### 2.9 故障发现

### 3.0 故障恢复

